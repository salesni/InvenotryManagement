package com.ticket.model;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.cloud.context.config.annotation.RefreshScope;

import com.commons.entity.Detalles;
import com.commons.entity.Ticket;
import com.ticket.client.DetalleClient;
import com.ticket.service.IDetallesService;
import com.ticket.service.ITicketsLogicService;

@RefreshScope
public class TicketLogic {
	final Double  tax=0.15;
	private Ticket ticket;
	
	@Autowired
	@Qualifier("ServiceFeign2")
	private IDetallesService service;
	
	public TicketLogic(Ticket ticket){
		this.ticket=ticket;
	}
	
	public void calcAll(){
		this.ticket.setImpuesto(tax);
		calcSubTotal();
		calcTotal();
		
	}
	
	public void calcTotal() {
		Double subtotal = this.ticket.getSubtotal();
		this.ticket.setTotal(subtotal*this.tax);
	}
	
	public void calcSubTotal() {
		List<Detalles> detalles = this.ticket.getDetalles();
		Double total=0.0;
		for(Detalles detalle : detalles) {
			Detalles registerDetalle = detalleClient.findById(detalle.getId()).get();
			total+=Double.valueOf(registerDetalle.getCantidad()) *registerDetalle.getInventario().getPrecio();
		}
		this.ticket.setSubtotal(total);
		
	}

	public Ticket getTicket() {
		return ticket;
	}

	public void setTicket(Ticket ticket) {
		this.ticket = ticket;
	}
	
	
	
	
	

}
